# Australian rodent skull allometry (Chapter 3 of Thesis) - data and code
Code authors: Ariel E. Marcy, Thomas Guillerme, Emma Sherratt

To cite the paper and/or code:
> Coming soonish

As of November 2019, this is still a work in progress. Uses R (v. 3.6.1) and geomorph (v. 3.1.3).

*All of the scripts are in RMarkdown format (.Rmd), which can be opened in RStudio. There, you can edit and run code chunks as normal, or you can click the Knit button to create HTML versions with both code and output. After cloning this repo, remember to either set your working directory to the allometry-rodents folder on your computer, or open an RStudio project from that folder.*

## Data
**Landmarking data:**
* [MorphoSource Project 561](https://www.morphosource.org/MyProjects/Dashboard/dashboard/select_project_id/561) publically provides 3D meshes for all surface scanned crania in the study
* [Raw_Coordinates.csv](Data/Raw/Raw_Coord_Data.csv) provides the shape coordinates from landmarking 3D skulls in Viewbox 

**Museum metadata provided by Curators:**
* [Australian Museum specimens](/Data/Raw/AM_muridae_skulls.csv)
* [Melbourne Museum specimens](/Data/Raw/MV_muridae_skulls.csv)
* [Queensland Museum specimens](/Data/Raw/QM_muridae_skulls.csv)
* [South Australian Museum specimens](/Data/Raw/SAM_muridae_skulls.csv)

**Ecological metadata:**
* [Trait data from Breed & Ford 2007](/Data/Processed/in_ex_traits.csv)

If you use these data, please cite the original authors:
> Breed B & Ford F. 2007. Native Mice and Rats. Australian Natural History Series, CSIRO Publishing: Colling-wood, Victoria, Australia, 185 pp. ISBN 978-0-6430-9166-5.

**Phylogenetic data:**
* [Fossil calibrated ultrametric tree modified from Smissen & Rowe 2018](/Data/Processed/Marcy-BEAST01.con.tre)

If you use these data, please cite this paper and the original authors:
> Smissen PJ & Rowe KC. 2018. Repeated biome transitions in the evolution of Australian Rodents. Molecular Phylogenetics and Evolution. 128:182â€“191. doi: 10.1016/j.ympev.2018.07.015.
    
## Analyses
The first three scripts prepare the data for analysis and graphing, the intermediate data generated by script 03 is stored in .rda files and used in following data analyses reported in the main article:

* **01-extract-data-for-analyses.Rmd** Extracts both 3D coordinate data and metadata from Viewbox. Prepares it for analysis in `geomorph` by running GPA with bilateral symmetry and then merging the symmetric shape component with centroid size.
* **02-calculate-user-error.Rmd** Allows users to view outliers and find major landmarking errors. Calculates user error based on repeatability.
* **03-prepare-data.Rmd** Creates the metadata and graphing vectors needed for all subsequent analyses. Prepares mean shape data and the ultrametric phylogenetic tree for analyses that require a phylogeny. 

The latter scripts produce the main results reported in the article:

* **04-measure-allometry.Rmd** Tests static allometry with `geomorph`'s `procD.lm`'s ANOVA function. `RRPP`'s `pairwise` function is used to perform pairwise slope comparisons through a homogeneity of slopes (HOS) test. Tests whether the HOS result is a null result with a randomization procedure. Plots static allometry with both Regression Scores and Predicted Values. Repeats steps for evolutionary allometry at the clade level. Tests for impact of species-level sample sizes with rarifaction across the phylogeny using `landvR`.  **Generates Figure 1, Table S1, Table S4, and Supplementary Figure TK**.
* **05-plot-heatmaps.Rmd** Plot heatmaps showing a statistically rigorous visualization of how landmarks vary from PC1 mininum to PC1 maximum. Ilustrates the allometric changes in Australian rodents. **Generates images used in Figure 2**.
* **06-plot-evolutionary-allometry.Rmd**  Plots evolutionary allometry of mean shape data, a PCA of the mean shape data, and two heatmap views of the crania shape changes across PC1. **Generates Figure 2**.
* **07-find-evolutionary-rates.Rmd** Runs `geomorph`'s `compare.evol.rates()` function on species with locomotion and dietary specializations to see if they evolved more slowly or more quickly than sister taxa. **Generates Table 2**.

* **Sup01-combine-metadata-sex-info.Rmd** This supplementary script reattaches sex information and museum of origin to the specimen metadata using the four museums' original metadata. **Generates Table S1**

**Custom functions:** The analyses call custom functions, most of which are defined in the [..Data/Functions/utilities.R](/Data/Functions/utilities.R) file.

A modified version of `geomorph`'s function `plotGMPhyloMorphoSpace` is defined in the [..Data/Functions/plotGMPhyloMorphoSpace_plotmod.R](/Data/Functions/plotGMPhyloMorphoSpace_plotmod.R) file.
